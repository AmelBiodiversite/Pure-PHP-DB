==============================================
RAPPORT D'EXPLORATION - MARKETFLOW
Date: Thu Feb  5 12:32:37 PM CET 2026
==============================================

üìÇ 1. STRUCTURE DES DOSSIERS
---
.
‚îú‚îÄ‚îÄ app
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ controllers
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AccountController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AdminController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ApiController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AuthController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ CartController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ExportController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ HomeController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ OrderController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ PaymentController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ProductController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ReviewController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ SecurityController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ SellerController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ StripeController.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ WishlistController.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ helpers
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ auth_helper.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ functions.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ security_helper.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ models
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Cart.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Order.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Product.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ User.php
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Wishlist.php
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ views
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ account
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ admin
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ auth
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ cart
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ checkout
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ home
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ layouts
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ orders
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ payment
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ products
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ seller
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ wishlist
‚îú‚îÄ‚îÄ arbo
‚îú‚îÄ‚îÄ ARCHITECTURE.md
‚îú‚îÄ‚îÄ assets
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ css
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ main.css
‚îú‚îÄ‚îÄ cat√©gories
‚îú‚îÄ‚îÄ Changelog.md
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ composer.json.backup
‚îú‚îÄ‚îÄ composer.lock
‚îú‚îÄ‚îÄ config
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ config.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ config.php.backup_css
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ config.php.backup_manual
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ currency.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ routes.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ security_headers.php
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ session.php
‚îú‚îÄ‚îÄ CONTRAT_LICENCE_TEMPLATE.md
‚îú‚îÄ‚îÄ core
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Controller.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ CSRF.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Database.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Database.php.backup
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EmailAlertService.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Env.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Helpers.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Model.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ RateLimiter.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Router.php
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ SecurityLogger.php
‚îú‚îÄ‚îÄ data
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ cache
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ logs
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ security.log
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ marketflow.db
‚îú‚îÄ‚îÄ database
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ export_replit_products.sql
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ FULL_IMPORT.sql
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ marketflow_production.sql
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ marketflow.sql
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ promo_codes.sql
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ schema.sql
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docs
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_code_sample.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_dependances.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_fichiers_php.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_logs_acces.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_logs_erreurs.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_marketflow_20260123_134429.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_performance.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_requetes_lentes.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_schema_sql.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_structure.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ audit_tables_size.txt
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ removed_files
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ backups
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ 2026-02-04_security_fixes
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ 2026-02-05_index_php
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ FEATURES_OVERVIEW.md
‚îú‚îÄ‚îÄ generate-security-data.php
‚îú‚îÄ‚îÄ index.php
‚îú‚îÄ‚îÄ INFOS_TECHNIQUES_MARKETFLOW.md
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ package-lock.json
‚îú‚îÄ‚îÄ public
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ clear-flash.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ css
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ animations.css
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ notifications.css
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ style.css
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ h pour admin123
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ index.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ animations.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ app.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ libs
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ notifications.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ wishlist.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ robots.txt
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ router.php
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ sitemap.xml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ uploads
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ products
‚îú‚îÄ‚îÄ README_CLIENT_CLEAN.md
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ replit.md
‚îú‚îÄ‚îÄ replit.nix
‚îú‚îÄ‚îÄ SALES_PITCH.md
‚îú‚îÄ‚îÄ SECURITY_AUDIT_REPORT.md
‚îú‚îÄ‚îÄ structure.txt
‚îú‚îÄ‚îÄ test_login.php
‚îú‚îÄ‚îÄ test_price_security.php
‚îî‚îÄ‚îÄ tests
    ‚îú‚îÄ‚îÄ Feature
    ‚îî‚îÄ‚îÄ Unit

41 directories, 99 files


üìÑ 2. FICHIERS PHP PRINCIPAUX (racine + 1 niveau)
---
./config/config.php
./config/currency.php
./config/routes.php
./config/security_headers.php
./config/session.php
./core/Controller.php
./core/CSRF.php
./core/Database.php
./core/EmailAlertService.php
./core/Env.php
./core/Helpers.php
./core/Model.php
./core/RateLimiter.php
./core/Router.php
./core/SecurityLogger.php
./generate-security-data.php
./index.php
./public/clear-flash.php
./public/index.php
./public/router.php
./test_login.php
./test_price_security.php


üì¶ 3. COMPOSER.JSON
---
{
    "name": "marketflow/pro",
    "description": "Marketplace digitale professionnelle avec multi-vendeurs, paiement Stripe et s\u00e9curit\u00e9 avanc\u00e9e",
    "type": "project",
    "keywords": [
        "marketplace",
        "e-commerce",
        "multi-vendor",
        "stripe",
        "postgresql"
    ],
    "license": "MIT",
    "authors": [
        {
            "name": "Amel Ben Maamar",
            "email": "amel@marketflow.com"
        }
    ],
    "require": {
        "php": ">=8.0",
        "ext-pdo": "*",
        "ext-pgsql": "*",
        "ext-mbstring": "*",
        "ext-json": "*",
        "stripe/stripe-php": "^19.2",
        "vlucas/phpdotenv": "^5.5",
        "symfony/var-dumper": "^6.4"
    },
    "require-dev": {
        "phpunit/phpunit": "^10.5",
        "phpstan/phpstan": "^1.10",
        "squizlabs/php_codesniffer": "^3.8"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Core\\": "core/",
            "App\\Controllers\\": "app/controllers/",
            "App\\Models\\": "app/models/"
        },
        "files": [
            "app/helpers/auth_helper.php",
            "app/helpers/functions.php",
            "app/helpers/security_helper.php"
        ]
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "test": "phpunit --colors=always",
        "test-coverage": "phpunit --coverage-html coverage",
        "analyse": "phpstan analyse app core --level=5",
        "lint": "phpcs --standard=PSR12 app core",
        "lint-fix": "phpcbf --standard=PSR12 app core",
        "dev": "php -d upload_max_filesize=50M -d post_max_size=50M -d memory_limit=256M -S 0.0.0.0:5000 -t public"
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}


üì¶ 4. PACKAGE.JSON
---
{"name": "php-pure", "scripts": {"dev": "php -d upload_max_filesize=50M -d post_max_size=50M -d memory_limit=256M -S 0.0.0.0:5000 -t ."}}

üîê 5. VARIABLES D'ENVIRONNEMENT (.env masqu√©)
---
# Configuration Email - MarketFlow Pro
SECURITY_ALERT_EMAIL=XXXXXXX
SECURITY_ALERT_FROM=XXXXXXX
SECURITY_ALERT_THRESHOLD=XXXXXXX
SECURITY_ALERT_COOLDOWN=XXXXXXX

# Configuration Base de donn√©es PostgreSQL - URL compl√®te
DATABASE_URL=XXXXXXX

# Configuration Base de donn√©es PostgreSQL
DB_CONNECTION=XXXXXXX
DB_HOST=XXXXXXX
DB_PORT=XXXXXXX
DB_DATABASE=XXXXXXX
DB_USERNAME=XXXXXXX
DB_PASSWORD=XXXXXXX


üö™ 6. PUBLIC/INDEX.PHP (point d'entr√©e)
---
<?php
// Point d'entr√©e pour le serveur PHP int√©gr√©
// Redirige vers le vrai index.php √† la racine

// Si c'est un fichier statique (CSS, JS, images), le servir directement
if (php_sapi_name() === 'cli-server') {
    $path = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
    $file = __DIR__ . $path;
    
    if (is_file($file)) {
        return false; // Servir le fichier statique
    }
}

// Sinon, router vers l'application
require_once __DIR__ . '/../index.php';


‚öôÔ∏è  7. FICHIERS DE CONFIGURATION
---
Recherche de fichiers config...
./config/config.php

Contenu du premier fichier config trouv√©:
Fichier: ./config/config.php
<?php
/**
 * MARKETFLOW PRO - CONFIGURATION
 * Configuration principale de l'application
 * 
 * Ce fichier d√©tecte automatiquement l'environnement (local vs production)
 * et adapte les chemins CSS/JS en cons√©quence
 */

// ================================================================
// CONFIGURATION DATABASE
// ================================================================
define('DATABASE_URL', getenv('DATABASE_URL'));

// ================================================================
// CONFIGURATION URLs
// ================================================================
// D√©tection automatique de l'URL de base selon l'environnement
$protocol = (($_SERVER['HTTPS'] ?? 'off') === 'on' || getenv('RAILWAY_ENVIRONMENT')) ? 'https' : 'http';
define('APP_URL', $protocol . '://' . ($_SERVER['HTTP_HOST'] ?? 'localhost'));

// ================================================================
// D√âTECTION AUTOMATIQUE DE L'ENVIRONNEMENT
// ================================================================
// Railway d√©finit RAILWAY_ENVIRONMENT en production
$isProduction = getenv('RAILWAY_ENVIRONMENT') || isset($_SERVER['RAILWAY_ENVIRONMENT']);

if ($isProduction) {
    // ============================================================
    // PRODUCTION (Railway)
    // ============================================================
    // Sur Railway, le serveur pointe vers la racine du projet
    // Les fichiers statiques sont dans /public/css/, /public/js/
// Sur Railway, le Dockerfile d√©marre avec -t public
// Donc /public/ EST la racine web, les fichiers sont √† /css/ pas /public/css/

    define('CSS_URL', APP_URL . '/css');
    define('JS_URL', APP_URL . '/js');
    define('IMG_URL', APP_URL . '/img');
    define('UPLOAD_URL', APP_URL . '/uploads');
} else {
    // ============================================================
    // LOCAL (Chromebook avec php -S depuis /public/)
    // ============================================================
    // En local, le serveur PHP int√©gr√© d√©marre depuis /public/
    // Donc les fichiers sont accessibles directement √† /css/, /js/
    define('CSS_URL', APP_URL . '/css');
    define('JS_URL', APP_URL . '/js');
    define('IMG_URL', APP_URL . '/img');
    define('UPLOAD_URL', APP_URL . '/uploads');
}

// ================================================================
// CONFIGURATION CURRENCY
// ================================================================
if (file_exists(__DIR__ . '/currency.php')) {
    require_once __DIR__ . '/currency.php';
}

if (!defined('APP_CURRENCY')) define('APP_CURRENCY', '‚Ç¨');
if (!defined('APP_CURRENCY_POS')) define('APP_CURRENCY_POS', 'right');

// Alias pour compatibilit√©
if (!defined('CURRENCY')) define('CURRENCY', APP_CURRENCY);

// ================================================================
// CONFIGURATION STRIPE
// ================================================================
define('STRIPE_PUBLIC_KEY', getenv('STRIPE_PUBLIC_KEY') ?: 'pk_test_YOUR_PUBLIC_KEY');
define('STRIPE_SECRET_KEY', getenv('STRIPE_SECRET_KEY') ?: 'sk_test_YOUR_SECRET_KEY');
define('STRIPE_WEBHOOK_SECRET', getenv('STRIPE_WEBHOOK_SECRET') ?: 'whsec_YOUR_WEBHOOK_SECRET');

// ================================================================
// CONFIGURATION MAIL
// ================================================================
define('MAIL_FROM', 'noreply@marketflow.com');

// ================================================================
// CONFIGURATION UPLOADS
// ================================================================
define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5 MB
define('ALLOWED_EXTENSIONS', ['jpg', 'jpeg', 'png', 'gif', 'pdf', 'zip']);

// ================================================================
// CONFIGURATION PLATEFORME
// ================================================================
define('PLATFORM_COMMISSION', 10); // 10% de commission

// ================================================================
// HELPER FUNCTIONS
// ================================================================
if (!function_exists('url')) {
    /**
     * G√©n√®re une URL compl√®te √† partir d'un chemin
     * @param string $path Chemin relatif (ex: 'products/123')
     * @return string URL compl√®te
     */
    function url($path = '') {
        return APP_URL . '/' . ltrim($path, '/');
    }
}

if (!function_exists('uploadUrl')) {
    /**
     * G√©n√®re une URL vers un fichier upload√©
     * @param string $file Nom du fichier (ex: 'products/image.jpg')
     * @return string URL compl√®te vers le fichier upload√©
     */
    function uploadUrl($file = '') {
        return UPLOAD_URL . '/' . ltrim($file, '/');
    }
}

// ================================================================
// CHARGER .env SI PR√âSENT (pour d√©veloppement local)
// ================================================================
if (file_exists(__DIR__ . '/../.env')) {
    $lines = file(__DIR__ . '/../.env', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
    foreach ($lines as $line) {
        $line = trim($line);
        // Ignorer les commentaires et lignes vides
        if (empty($line) || strpos($line, '#') === 0) continue;
        // Ignorer les lignes sans '='
        if (strpos($line, '=') === false) continue;
        
        // S√©parer la cl√© et la valeur
        list($name, $value) = explode('=', $line, 2);
        $name = trim($name);
        $value = trim($value);
        
        // D√©finir la variable d'environnement si nom et valeur non vides
        if (!empty($name) && !empty($value)) {
            putenv($name . '=' . $value);
        }
    }
}


üõ£Ô∏è  8. FICHIERS DE ROUTING
---
./config/routes.php
./core/Router.php

Contenu de ./config/routes.php:
<?php
/**
 * MARKETFLOW PRO - ROUTES
 * Toutes les routes AVANT $router->dispatch() !
 */

$router = new Core\Router();

// ================================================================
// ROUTES PUBLIQUES
// ================================================================

$router->get('/', 'HomeController@index');

// Authentification
$router->get('/login', 'AuthController@login');
$router->post('/login', 'AuthController@login');
$router->get('/register', 'AuthController@register');
$router->post('/register', 'AuthController@register');
$router->get('/logout', 'AuthController@logout');

// Pages info
$router->get('/sellers', 'HomeController@sellers');
$router->get('/seller/{username}/products', 'ProductController@sellerProducts');
$router->get('/about', 'HomeController@about');
$router->get('/contact', 'HomeController@contact');
$router->post('/contact', 'HomeController@contactSubmit');
$router->get('/terms', 'HomeController@terms');
$router->get('/privacy', 'HomeController@privacy');
$router->get('/help', 'HomeController@help');

// ================================================================
// ROUTES UTILISATEURS (Auth requise)
// ================================================================

$router->get('/profile', 'AuthController@profile');
$router->post('/profile/update', 'AuthController@updateProfile');
$router->post('/profile/password', 'AuthController@changePassword');
$router->post('/profile/seller', 'AuthController@updateSellerProfile');
$router->get('/account', 'AccountController@index');
$router->get('/account/downloads', 'AccountController@downloads');

// ================================================================
// ROUTES PRODUITS
// ================================================================

// Routes fixes AVANT routes dynamiques
$router->get('/products', 'ProductController@index');
$router->get('/products/search', 'ProductController@search');

// Routes cat√©gories (AVANT /products/{slug} pour √©viter conflit)
$router->get('/category', 'ProductController@categories');
$router->get('/category/{slug}', 'ProductController@category');

// Route dynamique produit (EN DERNIER)
$router->get('/products/{slug}', 'ProductController@show');

// ================================================================
// WISHLIST
// ================================================================

$router->get('/wishlist', 'WishlistController@index');
$router->post('/wishlist/add', 'WishlistController@add');
$router->post('/wishlist/remove', 'WishlistController@remove');
$router->get('/wishlist/count', 'WishlistController@count');

// ================================================================
// PANIER & COMMANDES
// ================================================================

// Panier
$router->get('/cart', 'CartController@index');
$router->post('/cart/add', 'CartController@add');
$router->post('/cart/remove', 'CartController@remove');
$router->post('/cart/update', 'CartController@update');
$router->post('/cart/clear', 'CartController@clear');
$router->post('/cart/apply-promo', 'CartController@applyPromo');
$router->get('/cart/remove-promo', 'CartController@removePromo');

// Checkout
$router->get('/checkout', 'CartController@checkout');
$router->post('/checkout/create-session', 'CartController@processCheckout');
$router->get('/checkout/success', 'PaymentController@success');
$router->get('/checkout/success', 'StripeController@success');
$router->post('/checkout/create-session', 'StripeController@createCheckoutSession');
$router->post('/stripe/create-checkout-session', 'StripeController@createCheckoutSession');
$router->get('/checkout/cancel', 'CartController@index');

// Paiement
$router->get('/payment/success', 'PaymentController@success');
$router->get('/payment/cancel', 'PaymentController@cancel');
$router->post('/webhooks/stripe', 'PaymentController@stripeWebhook');

// Commandes
$router->get('/orders', 'OrderController@index');
$router->get('/orders/{orderNumber}', 'OrderController@show');
$router->get('/orders/{orderNumber}/download/{itemId}', 'OrderController@download');

// ================================================================
// VENDEURS (Auth seller/admin)
// ================================================================

$router->get('/seller/dashboard', 'SellerController@dashboard');
$router->get('/seller/products', 'SellerController@products');
$router->get('/seller/products/create', 'SellerController@createProduct');
$router->post('/seller/products/store', 'SellerController@storeProduct');
$router->get('/seller/products/{id}/edit', 'SellerController@editProduct');
$router->post('/seller/products/{id}/update', 'SellerController@updateProduct');
$router->post('/seller/products/{id}/delete', 'SellerController@deleteProduct');
$router->get('/seller/sales', 'SellerController@sales');
$router->get('/seller/earnings', 'SellerController@earnings');
$router->post('/seller/payout', 'SellerController@requestPayout');
$router->get('/seller/analytics', 'SellerController@analytics');

// ================================================================
// ADMIN (Auth admin)
// ================================================================

$router->get('/admin', 'AdminController@index');
$router->get('/admin/dashboard', 'AdminController@index');
$router->get('/admin/users', 'AdminController@users');
$router->post('/admin/users/{id}/toggle', 'AdminController@toggleUser');
$router->post('/admin/users/{id}/suspend', 'AdminController@suspendUser');
$router->post('/admin/users/{id}/activate', 'AdminController@activateUser');
$router->post('/admin/users/{id}/delete', 'AdminController@deleteUser');
$router->get('/admin/products', 'AdminController@products');
$router->get('/admin/products/approve/{id}', 'AdminController@approveProduct');
$router->post('/admin/products/approve/{id}', 'AdminController@approveProduct');
$router->get('/admin/stats', 'AdminController@stats');

// Exports CSV
$router->get('/admin/export/users', 'ExportController@users');
$router->get('/admin/export/products', 'ExportController@products');
$router->get('/admin/export/orders', 'ExportController@orders');

// ================================================================
// API REST
// ================================================================

$router->get('/api', 'ApiController@index');
$router->get('/api/products', 'ApiController@products');
$router->get('/api/products/{slug}', 'ApiController@product');
$router->get('/api/categories', 'ApiController@categories');

// ================================================================
// S√âCURIT√â (Auth admin)
// ================================================================

$router->get('/admin/security', 'SecurityController@index');
$router->get('/admin/security/api/events', 'SecurityController@apiEvents');
$router->get('/admin/security/download/{date}', 'SecurityController@downloadLog');

// ================================================================
// DISPATCHER - TOUJOURS EN DERNIER !
// ================================================================

$router->dispatch();

üéÆ 9. CONTROLLERS
---
./app/controllers/AccountController.php
./app/controllers/AdminController.php
./app/controllers/ApiController.php
./app/controllers/AuthController.php
./app/controllers/CartController.php
./app/controllers/ExportController.php
./app/controllers/HomeController.php
./app/controllers/OrderController.php
./app/controllers/PaymentController.php
./app/controllers/ProductController.php
./app/controllers/ReviewController.php
./app/controllers/SecurityController.php
./app/controllers/SellerController.php
./app/controllers/StripeController.php
./app/controllers/WishlistController.php


üóÑÔ∏è  10. MODELS
---
./app/models/Order.php
./app/models/Product.php
./app/models/User.php
./app/models/Wishlist.php
./app/models/Cart.php


üí≥ 11. CONFIGURATION STRIPE DANS LE CODE
---
Fichiers contenant 'STRIPE':
./app/controllers/CartController.php:            'stripe_public_key' => STRIPE_PUBLIC_KEY, // Cl√© publique Stripe pour le frontend
./app/controllers/CartController.php:     * TRAITER LE PAIEMENT STRIPE
./app/controllers/CartController.php:        // 7Ô∏è‚É£ CR√âATION DE LA SESSION STRIPE
./app/controllers/CartController.php:            \Stripe\Stripe::setApiKey(STRIPE_SECRET_KEY);
./app/controllers/CartController.php:            // 9Ô∏è‚É£ GESTION DES ERREURS STRIPE
./app/controllers/PaymentController.php:        \Stripe\Stripe::setApiKey(STRIPE_SECRET_KEY);
./app/controllers/PaymentController.php:        $sigHeader = $_SERVER['HTTP_STRIPE_SIGNATURE'] ?? '';
./app/controllers/PaymentController.php:                STRIPE_WEBHOOK_SECRET
./app/controllers/StripeController.php:            \Stripe\Stripe::setApiKey(STRIPE_SECRET_KEY);
./config/config.php:// CONFIGURATION STRIPE
./config/config.php:define('STRIPE_PUBLIC_KEY', getenv('STRIPE_PUBLIC_KEY') ?: 'pk_test_YOUR_PUBLIC_KEY');
./config/config.php:define('STRIPE_SECRET_KEY', getenv('STRIPE_SECRET_KEY') ?: 'sk_test_YOUR_SECRET_KEY');
./config/config.php:define('STRIPE_WEBHOOK_SECRET', getenv('STRIPE_WEBHOOK_SECRET') ?: 'whsec_YOUR_WEBHOOK_SECRET');

Fichiers contenant 'stripe' (code):


üóÑÔ∏è  12. GESTION BASE DE DONN√âES
---
Fichiers SQL/Migrations:
./database/FULL_IMPORT.sql
./database/export_replit_products.sql
./database/marketflow.sql
./database/marketflow_production.sql
./database/promo_codes.sql
./database/schema.sql
./docs/audit/audit_schema_sql.txt

Connexions PDO dans le code:
./app/controllers/ProductController.php:$reviews = $stmt->fetchAll(\PDO::FETCH_ASSOC);
./app/controllers/ProductController.php:    $userReview = $stmt->fetch(\PDO::FETCH_ASSOC);
./app/controllers/ProductController.php:        $purchase = $stmt->fetch(\PDO::FETCH_ASSOC);
./app/controllers/ReviewController.php:        $product = $stmt->fetch(\PDO::FETCH_ASSOC);
./app/controllers/ReviewController.php:        $purchase    = $stmt->fetch(\PDO::FETCH_ASSOC);
./app/controllers/ReviewController.php:        $review = $stmt->fetch(\PDO::FETCH_ASSOC);
./app/controllers/ReviewController.php:        $pendingReviews = $stmt->fetchAll(\PDO::FETCH_ASSOC);
./app/controllers/SellerController.php:        $tags = $stmt->fetchAll(\PDO::FETCH_COLUMN);
./app/models/Order.php:            return $stmt->fetch(PDO::FETCH_ASSOC);
./app/models/Order.php:        $result = $stmt->fetch(PDO::FETCH_ASSOC);


üîê 13. AUTHENTIFICATION
---
Fichiers li√©s √† l'authentification:
./app/helpers/auth_helper.php
./app/views/auth
./app/views/auth/login.php
./config/session.php
./test_login.php

Code de gestion de session:
./app/controllers/AuthController.php:            session_start();
./app/controllers/CartController.php:            $session = \Stripe\Checkout\Session::create([
./app/controllers/PaymentController.php:            $session = \Stripe\Checkout\Session::retrieve($sessionId);
./app/controllers/StripeController.php:            $session = \Stripe\Checkout\Session::create([
./app/models/Cart.php:            session_start();
./config/security_headers.php: * ‚ö†Ô∏è IMPORTANT : √Ä charger dans index.php APR√àS session_start()
./config/session.php: * ‚ö†Ô∏è IMPORTANT : √Ä charger AVANT session_start() dans index.php
./public/clear-flash.php:session_start();
./test_price_security.php:session_start();
./index.php:// ‚ö†Ô∏è IMPORTANT : Doit √™tre charg√© AVANT session_start()


‚öñÔ∏è  14. PAGES L√âGALES
---
./app/views/home/privacy.php


üîí 15. S√âCURIT√â
---
Protection CSRF:
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken() // Token pour s√©curiser le formulaire
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:        if (!\Core\CSRF::validateToken($_POST['csrf_token'] ?? '')) {
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:        if (!\Core\CSRF::validateToken($_POST['csrf_token'] ?? '')) {
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()
./app/controllers/AuthController.php:                'csrf_token' => \Core\CSRF::generateToken()

Validation/Sanitization:
./app/controllers/AuthController.php:        if (!\Core\CSRF::validateToken($_POST['csrf_token'] ?? '')) {
./app/controllers/AuthController.php:        if (!\Core\CSRF::validateToken($_POST['csrf_token'] ?? '')) {
./app/controllers/AuthController.php:        if (empty($data['email']) || !filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {
./app/controllers/CartController.php:        if (!CSRF::validateToken($token)) {
./app/controllers/CartController.php:        $productId = filter_var($_POST['product_id'] ?? null, FILTER_VALIDATE_INT);
./app/controllers/CartController.php:        $quantity = filter_var($_POST['quantity'] ?? 1, FILTER_VALIDATE_INT);
./app/controllers/CartController.php:        if (!CSRF::validateToken($token)) {
./app/controllers/CartController.php:        $productId = filter_var($_POST['product_id'] ?? null, FILTER_VALIDATE_INT);
./app/controllers/CartController.php:        if (!CSRF::validateToken($token)) {
./app/controllers/CartController.php:        $productId = filter_var($_POST['product_id'] ?? null, FILTER_VALIDATE_INT);


üì§ 16. GESTION DES UPLOADS
---
Dossiers d'upload:
./public/uploads
./public/uploads/products/files

Code de gestion d'upload:
./app/models/Product.php:        $uploadDir = UPLOAD_DIR . 'products/thumbnails/';
./app/models/Product.php:        if (!move_uploaded_file($file['tmp_name'], $filepath)) {
./app/models/Product.php:        $uploadDir = UPLOAD_DIR . 'products/files/';
./app/models/Product.php:        if (!move_uploaded_file($file['tmp_name'], $filepath)) {
./config/config.php:    define('UPLOAD_URL', APP_URL . '/uploads');
./config/config.php:    define('UPLOAD_URL', APP_URL . '/uploads');
./config/config.php:// CONFIGURATION UPLOADS
./config/config.php:        return UPLOAD_URL . '/' . ltrim($file, '/');


üìù 17. CONTENU DU .GITIGNORE
---
# ============================================================================
# MARKETFLOW PRO - .gitignore
# ============================================================================

# ----------------------------------------------------------------
# Composer
# ----------------------------------------------------------------
/vendor/
composer.lock

# ----------------------------------------------------------------
# Environnement
# ----------------------------------------------------------------
.env
.env.local
.env.*.local

# ----------------------------------------------------------------
# Uploads & Cache
# ----------------------------------------------------------------
/public/uploads/*
!/public/uploads/.gitkeep
/data/logs/*
!/data/logs/.gitkeep
/data/cache/*
!/data/cache/.gitkeep

# ----------------------------------------------------------------
# IDE & √âditeurs
# ----------------------------------------------------------------
.vscode/
.idea/
*.swp
*.swo
*~
.DS_Store

# ----------------------------------------------------------------
# Tests & Coverage
# ----------------------------------------------------------------
/coverage/
.phpunit.result.cache
phpunit.xml

# ----------------------------------------------------------------
# Build & Temp
# ----------------------------------------------------------------
/build/
/dist/
*.log
*.tmp

# ----------------------------------------------------------------
# OS
# ----------------------------------------------------------------
Thumbs.db
desktop.ini

# ----------------------------------------------------------------
# Backups
# ----------------------------------------------------------------
*.sql.backup
*.sql.gz
*.bak


üìñ 18. README (si existe)
---
# üöÄ MarketFlow Pro - Plateforme Marketplace Professionnelle

**Marketplace multi-vendeurs pr√™te pour la production** | PHP/PostgreSQL | 40 000+ lignes

[![PHP Version](https://img.shields.io/badge/PHP-8.0%2B-777BB4?logo=php&logoColor=white)](https://php.net)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-12%2B-336791?logo=postgresql&logoColor=white)](https://postgresql.org)
[![Stripe](https://img.shields.io/badge/Stripe-Int√©gr√©-635BFF?logo=stripe&logoColor=white)](https://stripe.com)
[![License](https://img.shields.io/badge/Licence-Commerciale-success)](LICENSE.md)

---

## üéØ Qu'est-ce que MarketFlow Pro ?

Une plateforme marketplace **compl√®te, s√©curis√©e et √©volutive** pour la vente de produits digitaux (templates, ebooks, formations, etc.) avec syst√®me de commission automatique et paiements Stripe int√©gr√©s.

**Parfait pour :**
- üè¢ **Agences web** d√©veloppant des solutions marketplace pour leurs clients
- üíº **D√©veloppeurs freelance** √©conomisant 3 mois de d√©veloppement
- üöÄ **Entrepreneurs** lan√ßant leur marketplace rapidement

---

## ‚ú® Fonctionnalit√©s Principales

### üõçÔ∏è **Pour les Acheteurs**
- Authentification s√©curis√©e & profils utilisateurs
- Catalogue avanc√© avec filtres (cat√©gories, prix, recherche)
- Panier avec codes promo
- Paiement Stripe int√©gr√©
- T√©l√©chargements illimit√©s (3x par produit)
- Historique commandes & factures
- Syst√®me d'avis et de notes
- Liste de souhaits (wishlist)

### üí∞ **Pour les Vendeurs**
- Dashboard vendeur complet avec analytics
- Upload produits (fichiers + images + galerie)
- Statistiques de ventes en temps r√©el avec Chart.js
- Graphiques revenus/ventes
- Syst√®me de paiement automatique
- Commission transparente (configurable)
- Gestion des avis clients

### üëë **Pour les Administrateurs**
- Dashboard admin global
- Workflow validation/rejet produits
- Gestion utilisateurs
- Mod√©ration des avis
- Statistiques globales de la plateforme
- Param√®tres syst√®me & logs
- **üîí UNIQUE : Dashboard de monitoring de s√©curit√© en temps r√©el**

---

## üîí Syst√®me de S√©curit√© Avanc√© (UNIQUE)

MarketFlow Pro int√®gre un **syst√®me de monitoring de s√©curit√© niveau entreprise** inexistant dans les autres marketplaces PHP :

### **Dashboard de S√©curit√© Live**
- üìä Monitoring en temps r√©el (login, tentatives CSRF, XSS, SQLi)
- üìà Statistiques sur 7 jours avec graphiques interactifs
- üö® D√©tection automatique des IPs suspectes
- üìß Alertes email si > 5 √©v√©nements critiques/heure
- üìù Logs rotatifs sur 30 jours

### **Protection Multi-Couches**
- ‚úÖ **CSRF** : 100% des formulaires prot√©g√©s avec tokens
- ‚úÖ **Injection SQL** : 156 requ√™tes pr√©par√©es (0 vuln√©rabilit√©)
- ‚úÖ **XSS** : Sanitisation syst√©matique
- ‚úÖ **Brute Force** : Rate limiting sur 6 endpoints
- ‚úÖ **Session Hijacking** : D√©tection automatique

**Composants s√©curit√© : 527 lignes de code √©prouv√©**

> ‚ö†Ô∏è **Cette fonctionnalit√© seule vaut 2 000‚Ç¨** et n'existe dans AUCUNE marketplace PHP open-source.

---

## üõ†Ô∏è Stack Technique

### **Backend**
- **PHP 8.2** - Typage strict, attributes, propri√©t√©s readonly
- **PostgreSQL 12+** - Support JSON, transactions, performance
- **Architecture MVC sur mesure** - Pas de framework lourd
- **PSR-4 Autoloading** - Standards PHP-FIG
- **156 requ√™tes pr√©par√©es** - Z√©ro vuln√©rabilit√© SQL injection

### **Frontend**
- **HTML5 / CSS3** - Balisage s√©mantique
- **JavaScript Vanilla** - Aucune d√©pendance framework
- **CSS Variables** - Th√©ming facile (dark mode inclus)
- **Grid / Flexbox** - Layouts responsive modernes

### **Int√©grations**
- **Stripe** - Syst√®me de paiement complet (checkout, webhooks, remboursements)
- **Chart.js** - Dashboards analytics √©l√©gants

### **S√©curit√©**
- **BCrypt** - Hash des mots de passe
- **Tokens CSRF** - Protection formulaires
- **Rate Limiting** - Pr√©vention brute force
- **Protection XSS** - Sanitisation des entr√©es

---

## üì¶ Installation Rapide

### **Pr√©requis**
- PHP >= 8.0
- PostgreSQL >= 12
- Serveur web (Apache/Nginx)
- Compte Stripe (mode test gratuit)

### **Installation (< 10 minutes)**
```bash
# 1. Cloner le d√©p√¥t
git clone https://github.com/adevance/marketflow-pro.git
cd marketflow-pro

# 2. Cr√©er la base de donn√©es
createdb marketflow_db

# 3. Importer le sch√©ma
psql marketflow_db < database/schema.sql

# 4. Configuration
cp config/config.example.php config/config.php
nano config/config.php  # √âditer avec vos param√®tres

# 5. Permissions
mkdir -p public/uploads/{products,avatars}
chmod -R 755 public/uploads

# 6. Configurer Stripe
# Ajouter vos cl√©s Stripe dans config/config.php

# 7. Acc√©der √† l'application
# http://votre-domaine.com
```

---

## üìä Statistiques du Code

| M√©trique | Valeur |
|----------|--------|
| **Lignes totales** | 40 000+ |
| **Fichiers PHP** | 87 |
| **Contr√¥leurs** | 14 |
| **Mod√®les** | 12 |
| **Vues** | 45+ |
| **Framework Core** | 2 258 lignes |
| **Syst√®me S√©curit√©** | 527 lignes |
| **Requ√™tes pr√©par√©es** | 156 |
| **Couverture tests** | Pr√™t production |

---

## üé® Captures d'√âcran

### Page d'accueil
![Homepage](docs/screenshots/homepage.png)

### Dashboard Vendeur
![Dashboard](docs/screenshots/seller-dashboard.png)

### Panel Admin
![Admin](docs/screenshots/admin-panel.png)

### Dashboard S√©curit√© (UNIQUE)
![Security](docs/screenshots/security-dashboard.png)

---

## üìö Documentation

- üìñ **[Guide d'Installation](docs/INSTALLATION.md)**
- üîß **[Configuration](docs/CONFIGURATION.md)**
- üèóÔ∏è **[Architecture](ARCHITECTURE.md)**
- üîê **[S√©curit√©](docs/SECURITY.md)**
- üöÄ **[D√©ploiement](docs/DEPLOYMENT.md)**
- üì° **[R√©f√©rence API](docs/API.md)**

---

## ‚ö° Performance

**Optimisations incluses :**
- üöÄ Requ√™tes optimis√©es avec index
- üíæ Lazy loading des images
- üóÑÔ∏è Cache syst√®me
- üì¶ CSS/JS minifi√©s
- üîÑ Chargement AJAX partiel

**Benchmarks (VPS 2CPU/4GB) :**
- Page d'accueil : < 500ms
- Catalogue produits : < 800ms
- Checkout : < 1s

---

## üí∞ Licence Commerciale

**Inclus avec l'achat :**
- ‚úÖ Acc√®s code source complet
- ‚úÖ Droits d'utilisation illimit√©s
- ‚úÖ Modifications autoris√©es
- ‚úÖ Usage commercial autoris√©
- ‚úÖ Support 60 jours
- ‚úÖ Mises √† jour 6 mois

**Non inclus :**
- ‚ùå Revente du code interdite
- ‚ùå Distribution gratuite interdite

**Prix :** 5 000‚Ç¨ (Offre lancement - 3 licences seulement)

---

## üéØ Calcul du ROI

| Composant | Heures dev | Taux (50‚Ç¨/h) | Valeur |
|-----------|------------|--------------|--------|
| Backend (40K lignes) | 250h | 50‚Ç¨ | 12 500‚Ç¨ |
| Syst√®me S√©curit√© | 30h | 50‚Ç¨ | 1 500‚Ç¨ |
| Int√©gration Stripe | 20h | 50‚Ç¨ | 1 000‚Ç¨ |
| Dashboard Admin | 40h | 50‚Ç¨ | 2 000‚Ç¨ |
| Frontend/UI | 80h | 50‚Ç¨ | 4 000‚Ç¨ |
| **TOTAL** | **420h** | | **21 000‚Ç¨** |

**Votre prix : 5 000‚Ç¨ = 76% d'√©conomie = 16 000‚Ç¨ √©conomis√©s**

---

## üöÄ Pourquoi MarketFlow Pro ?

### **vs D√©veloppement from scratch**
- ‚è∞ **3 mois √©conomis√©s** - Pr√™t √† d√©ployer en < 1 heure
- üí∞ **16 000‚Ç¨ √©conomis√©s** - Code professionnel √† fraction du co√ªt
- üîí **√âprouv√© en production** - S√©curit√© renforc√©e, pr√™t production
- üìö **Document√©** - Documentation compl√®te incluse

### **vs Autres solutions**
- ‚úÖ **Pas de frais mensuels** - Achat unique, √† vous pour toujours
- ‚úÖ **Code source complet** - Contr√¥le total & personnalisation
- ‚úÖ **Stack moderne** - PHP 8.2, PostgreSQL, derni√®res pratiques
- ‚úÖ **S√©curit√© unique** - Dashboard monitoring temps r√©el

---

## üìû Contact & Support

**Cr√©atrice :** A. Devanc√© - D√©veloppeuse Full-Stack Senior

üìß **Email :** a.devance@proton.me  
üíº **LinkedIn :** [linkedin.com/in/a-devance](https://linkedin.com/in/a-devance)  
üîó **D√©mo :** [Voir la d√©mo live](https://astonishing-nurturing-production.up.railway.app/)

---

## üôè Construit Avec

- [PHP](https://php.net) - Langage backend
- [PostgreSQL](https://postgresql.org) - Base de donn√©es
- [Stripe](https://stripe.com) - Paiements
- [Chart.js](https://chartjs.org) - Graphiques analytics

---

## üìÑ Licence

**Licence Commerciale** - Voir [LICENSE.md](LICENSE.md) pour d√©tails

---

<div align="center">

**MarketFlow Pro v1.0.0** - Janvier 2025

Cr√©√© avec ‚ù§Ô∏è par [A. Devanc√©](https://linkedin.com/in/a-devance)

[Acheter](mailto:a.devance@proton.me) ‚Ä¢ [Voir D√©mo](https://astonishing-nurturing-production.up.railway.app/) ‚Ä¢ [Documentation](docs/)

</div>


==============================================
FIN DU RAPPORT D'EXPLORATION
==============================================
